# **蓝胖子 AI 全自动选股系统 \- 产品设计框架 (V0.2)**

## **1\. 系统核心设计理念**

1. **作业流 (Pipeline) 导向**：每天的选股任务不是一个黑盒，而是一条由多个**节点 (Node)** 组成的流水线。  
2. **节点即服务 (Node as a Service)**：每个节点（如爬取、清洗、初选、精选）都是独立的，拥有独立的输入参数（配置）和输出结果（数据快照）。  
3. **无状态历史行情**：不维护庞大的本地行情库。计算时，通过 AkShare 接口实时获取指定日期的数据进行计算，仅将**计算结果**（如：当日涨幅、是否连板、成交量比）存入 MySQL 作为“选股依据”留痕。  
4. **全链路溯源**：通过外键关联，实现 股票 \-\> 异动逻辑 \-\> 热点板块 \-\> 原始文章 的完整追溯。

## ---

**2\. 业务流程架构 (The Pipeline)**

我们将每日的任务定义为一个 **"Daily Strategy Run" (每日策略执行)**，它包含以下四个串行节点。用户可以在界面上点击任意节点进行查看、修改配置并重跑。

### **节点 A：情报收集 (Info Gathering)**

* **功能**：执行你现有的公众号爬虫。  
* **输入**：公众号列表、关键词配置。  
* **输出**：原始文章列表 (Raw Articles)。  
* **可观测性**：查看当日爬取了多少篇文章，原文内容是什么。

### **节点 B：热点提炼 (Topic Extraction)**

* **功能**：调用 LLM 对节点 A 的文章进行清洗。  
* **输入**：节点 A 的文章 ID 集合、Prompt 提示词（可配）。  
* **输出**：**结构化热点表**（包含：热点名称、相关板块、预期强度、原始文章引用）。  
* **可观测性**：查看 AI 总结出了哪些风口，用户可以手动修正（如删除错误的板块）。  
* **交互**：用户若觉得 AI 总结不准，可修改 Prompt 或手动增删热点，点击“重新生成”，更新本节点输出。

### **节点 C：异动扫描 (Abnormal Scan) \-\> 生成 \[股票池 1\]**

* **功能**：结合 AkShare 行情 \+ 节点 B 的热点板块，筛选异动股。  
* **输入**：  
  * 节点 B 的热点板块列表。  
  * **异动规则配置**（JSON）：例如 { "vol\_ratio": 2.0, "limit\_up": true }。  
* **过程**：  
  1. 调用 AkShare 获取对应板块的成分股。  
  2. 调用 AkShare 获取成分股当日日线数据。  
  3. 应用规则过滤。  
* **输出**：**股票池 1 (初选池)**。  
* **溯源**：每只入池股票必须记录 Source\_Topic\_ID（关联到节点 B）。

### **节点 D：深度精选 (Deep Dive) \-\> 生成 \[股票池 2\]**

* **功能**：对股票池 1 进行基本面（AI分析）和技术面（硬指标）双重过滤。  
* **输入**：  
  * 节点 C 的股票列表。  
  * **过滤插件配置**：例如 { "market\_cap\_min": 50亿, "ma5\_support": true, "scarcity\_check": true }。  
* **过程**：  
  1. **技术面**：计算均线、换手率（AkShare 数据）。  
  2. **基本面**：调用 LLM 分析个股题材唯一性/产业链地位。  
* **输出**：**股票池 2 (终选池)** \+ **决策报告**。  
* **溯源**：记录被淘汰股票的原因，记录入选股票的详细得分。

## ---

**3\. 功能模块详细设计**

### **3.1 看板与日历 (Dashboard)**

* **日历视图**：以日历形式展示每天的“策略执行”记录。  
  * *状态标识*：🟢 完成 🟡 进行中 🔴 失败  
* **当日概览**：点击具体日期，进入该日的 **Pipeline 视图**。

### **3.2 节点详情与交互 (Workbench)**

这是系统的核心操作界面，分为左右两栏或上下结构。

#### **(1) 节点 A 视图：舆情源**

* **展示**：列表展示今日爬取的文章标题、来源、发布时间。  
* **操作**：  
  * “查看原文”：弹窗显示 PDF/HTML 内容。  
  * “手动补录”：如果爬虫漏了，允许用户手动粘贴一篇 URL 或文本进来。

#### **(2) 节点 B 视图：风口挖掘机**

* **配置区**：显示当前使用的 Prompt（如：“提取行业、概念”）。  
* **结果区**：卡片式展示挖掘出的热点。  
  * *卡片内容*：热点名称（如“低空经济”）、关联个股、热度评分。  
  * *人工干预*：用户可以点击“删除”某个不靠谱的热点，或者“编辑”关联个股。  
* **动作**：修改配置后，点击 **"重跑本节点"** \-\> 系统重新调用 LLM \-\> 覆盖当前结果。

#### **(3) 节点 C 视图：异动初筛 (股票池 1\)**

* **配置区 (参数面板)**：  
  * 成交量放大倍数：Input \[2.0\]  
  * 是否必须涨停：Switch \[On/Off\]  
  * 板块涨幅要求：Input \[\>3%\]  
* **结果区 (Table)**：  
  * 列：代码 | 名称 | 所属热点(来自节点B) | 现价 | 涨幅 | 量比 | **入选理由**  
  * *入选理由*：鼠标悬停显示（例如：“成交量放大 3.5 倍，所属 固态电池 板块”）。  
* **动作**：调整参数（比如把量比 2.0 改成 1.5），点击 **"重跑"** \-\> 触发 AkShare 重新拉取并过滤 \-\> 更新表格。

#### **(4) 节点 D 视图：决战圈 (股票池 2\)**

* **配置区 (插件开关)**：  
  * \[√\] 市值过滤 (50亿 \- 500亿)  
  * \[√\] 均线支撑 (收盘价 \> MA5)  
  * \[√\] 稀缺性检测 (AI 语义分析)  
* **结果区**：  
  * 最终金股列表。  
  * **下钻详情**：点击某只股票，展开侧边栏“个股档案”。  
    * **基本面卡片**：显示 AI 对其“唯一性”的评价（对应需求文档中的“细分领域不可替代性”）。  
    * **技术面卡片**：显示 K 线图（ECharts 回显），并在图上标记出买点信号。  
    * **溯源链**：显示 个股 \-\> 属于板块 X \-\> 板块 X 来自文章 Y 的完整路径。

## ---

**4\. 技术实现方案 (基于 Python \+ AkShare)**

### **4.1 数据流转逻辑**

虽然不存历史行情，但我们需要存储“中间结果”以便回溯。

* **MySQL 表设计思路 (简化版)**：  
  1. task\_run\_log: 记录每天的任务 ID、状态。  
  2. raw\_articles: 存节点 A 数据。  
  3. topic\_analysis: 存节点 B 数据（含 article\_id 外键）。  
  4. stock\_pool\_1: 存节点 C 结果。**关键点**：除了存股票代码，还要存**当时的快照数据**（如 snapshot\_vol\_ratio, snapshot\_price）。这样即使过了一个月，也能看到当时为什么选它。  
  5. stock\_pool\_2: 存节点 D 结果（含 pool1\_id 外键，以及 AI 具体的评价文本）。

### **4.2 AkShare 接口调用策略**

为了保证速度且避免被封 IP：

* **按需调用**：只有在节点 C 和 D 运行时才调用接口。  
* **缓存机制**：在一次 Run (例如 2023-10-27 的任务) 中，如果多次请求同一个股票的当日数据，通过 Python 内存字典或 Redis 进行短暂缓存。  
* **接口示例**：  
  * 获取板块成分股：ak.stock\_board\_industry\_cons\_em()  
  * 获取个股日线：ak.stock\_zh\_a\_hist(start\_date='20231027', end\_date='20231027')

### **4.3 自动化与调度**

* 使用 **APScheduler** (Python 轻量级调度库) 每天下午 15:30 自动触发任务。  
* 任务脚本按顺序执行 Function A \-\> B \-\> C \-\> D。  
* 如果在中途报错，记录状态为 Error，用户在前端可以看到红灯，修复后点击“从失败处继续”或“重跑”。

## ---

**5\. 交互设计 Demo (文字版)**

**场景：用户觉得今天选出的“万丰奥威”不应该入选。**

1. 用户打开 **\[2023-10-27\]** 的任务详情。  
2. 进入 **\[节点 D：深度精选\]** 页面。  
3. 在列表中找到“万丰奥威”，点击 **\[下钻\]**。  
4. 侧边栏显示：  
   * *来源热点*：低空经济（点击可跳转到节点 B 查看是哪篇文章提到的）。  
   * *技术指标*：MA5 上方 (Pass)。  
   * *AI 评价*：具有主机厂核心地位 (Pass)。  
5. 用户发现其实是因为“市值过滤”范围设太大了。  
6. 用户在左侧配置栏，将“最小市值”从 20 亿改为 100 亿。  
7. 点击 **\[更新节点配置并重跑\]**。  
8. 系统重新运行节点 D 的逻辑（无需重新爬文章，也无需重新跑 AkShare 获取所有异动股，只需对股票池 1 的数据应用新规则）。  
9. 页面刷新，“万丰奥威”消失，股票池 2 更新。

