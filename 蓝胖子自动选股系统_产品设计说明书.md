# **蓝胖子自动选股系统 \- 产品设计说明书 (V1.4)**

## **1\. 产品概述**

### **1.1 核心理念**

本系统是一个**可视化的主观策略工作台**。它将复杂的自动选股流程拆解为四个可视化的步骤（节点）。 用户以“**每日报告 (Daily Report)**”为单位进行操作，支持对每个节点的产出物进行观察、修改参数并重新执行，最终生成当日的决策股票池。

### **1.2 核心流程 (The Pipeline)**

1. **情报源** (公众号爬取/手动录入)  
2. **热点风口** (AI 提炼板块逻辑与板块名称)  
3. **异动初筛** (基于板块名称，通过akshare东方财富板块接口，获取对应板块的个股 \-\> 生成股票池 1\)  
4. **深度精选** (基本面+ 技术面选股规则 \-\> 生成股票池 2\)

## **2\. 页面架构图**

系统主要包含三个核心页面层级：

1. **首页 (Home)** - 首页，任务看板和报告列表。  
2. **报告管理 (Workbench)** \- 核心操作页，用列表卡片的方式显示每日生成的选股报告，点击可进入报告详情页。  
3. **报告详情页 (Report Detail)** \- 报告详情页，展示当日股票池2的最终结果，同时通过一个模块展示核心流程，可点击流程节点可观察该节点的产出物。  
4. **系统设置 (Settings)** \- 公众号配置（目标爬取公众号的创建、修改、删除与启停）、选股规则配置（基本面规则配置与技术面规则配置）。

## **3\. 详细功能设计**

### **3.1 首页 (Home)**

**核心目标**：提供快速开始的入口，并概览最近的选股动态。

**主要模块**：

* **快捷操作区**：  
  * \[生成今日报告\] 按钮：点击后，系统弹出日期选择框，默认“今日日期”。  
  * **日期选择逻辑**（与爬虫能力对齐）：  
    * **选择今日**：自动触发爬虫脚本，获取最新数据并生成报告。  
    * **选择历史日期**：**系统自动校验数据库**。  
      * 若该日期已有存量情报数据：直接生成报告并跳转。  
      * 若该日期无数据：**弹出提示**“无当日情报数据，是否创建空白报告并手动补录？”，确认后跳转至详情页供用户手动录入。  
* **最近动态区**：  
  * 展示最近生成的 3-5 份报告卡片。  
  * 卡片简要信息：日期、最终入选股票数量、核心热点关键词。

### **3.2 报告管理 (Workbench)**

**核心目标**：对历史选股报告进行归档和检索，创建新的选股报告。

**主要模块**：

* **历史报告列表**：  
  * 以卡片或列表形式展示所有历史报告。  
  * 支持按“日期”进行筛选/搜索。  
* **列表项信息**：  
  * 显示报告日期、状态（进行中/已完成）、最终选出的金股数量。  
  * 操作：点击进入详情页、删除报告。

### **3.3 报告详情页 (Report Detail) —— 核心交互页面**

**核心目标**：查看当日最终结果，并能对中间过程进行追溯和干预。

**页面布局**：

1. **顶部：最终决策结果 (Result Area)**  
   * 直接展示最终生成的![][image1]  
     列表，列表展示以下内容：股票名称、股票代码、入选原因（由AI总结，根据股票池2之前的数据）。  
   * 这是用户最关心的结果，打开页面第一眼就能看到。  
2. **中部：流程可视化组件 (Pipeline Visualizer)**  
   * 横向展示 4 个流程节点图标：  
     1. 情报源  
     2. 热点风口  
     3. 异动初筛  
     4. 深度精选  
   * **交互逻辑**：点击任意一个节点图标，下方的“过程数据区”会切换显示该节点的产出物。  
3. **底部：过程数据区 (Process Data Area)**  
   * **默认状态**：折叠或显示当前进度的节点信息。  
   * **内容动态切换**：  
     * **选中“情报源”**：  
       * 显示当日爬取/录入的文章列表。  
       * **\[关键交互\]**：提供 **\[手动补录情报\]** 按钮。允许用户粘贴文章链接或文本。对于无爬虫数据的历史报告，这是激活后续流程的唯一方式。  
     * **选中“热点风口”**：  
       * 显示 AI 提炼出的板块及该板块来自哪些公众号所提及。  
     * **选中“异动初筛”**：  
       * 显示股票池 1 的列表，列表内容：股票名、股票代码、所属板块。  
     * **选中“深度精选”**：  
       * 显示详细的评分和剔除原因。

### **3.4 系统设置 (Settings)**

**核心目标**：管理系统的基础配置，调整策略参数。

**主要模块**：

* **公众号配置**：  
  * 列表展示当前监控的公众号。  
  * 支持添加新公众号 ID、暂停/启用监控、删除公众号。  
* **选股规则配置**：  
  * **技术面参数**：如成交量放大倍数、均线周期等参数的默认值设置。  
  * **基本面参数**：如市值范围、AI 分析的 Prompt 提示词模板设置。

## **4\. 技术实现与架构设计**

### **4.1 核心能力复用与集成**

为提高开发效率，系统后端将直接复用并封装现有项目已验证的能力模块：

1. **公众号爬虫模块 (WeChat Crawler)**  
   * **复用逻辑**：复用现有的公众号爬取逻辑。鉴于公众号历史文章爬取的技术限制，**本系统不支持按日期回溯爬取**。  
   * **历史报告生成策略**：  
     * **今日报告**：触发爬虫获取今日最新文章，或读取手动录入的内容。  
     * **历史报告**：**不触发爬虫**。系统仅查询数据库中该日期下是否已存在采集的历史文章（由过去的任务产生）或用户手动补录的文章。  
     * **前置校验**：在生成历史报告前，系统会检查目标日期是否有存量文章数据。  
       * 若**无数据**：提示用户“无当日情报数据”，无法生成报告。  
       * 若**有数据**：直接复用历史采集/补录的内容，进入后续（热点风口 \-\> 异动初筛）流程。  
2. **Akshare 行情模块 (Market Data Fetcher)**  
   * **复用逻辑**：复用通过 akshare 接口获取“东方财富-板块成分股”的功能。  
   * **集成方式**：封装为 DataFetcherService。核心接口：  
     * get\_stocks\_by\_board(board\_name): 获取板块下的所有个股代码。  
     * get\_stock\_daily\_history(symbol, date): 获取指定日期的个股行情快照（开、高、低、收、量、换手）。

### **4.2 数据库设计 (Schema Design)**

数据库采用 **MySQL**。设计核心围绕“每日报告 (Daily Report)”这一主实体展开，确保每次选股过程的数据隔离与溯源。

#### **(1) 核心业务表**

* **reports (每日报告主表)**  
  * id: 主键  
  * report\_date: 报告日期 (YYYY-MM-DD)  
  * status: 状态 (processing, completed, error)  
  * created\_at: 创建时间  
* **raw\_articles (情报源表 \- 节点1产出)**  
  * id: 主键  
  * report\_id: 关联 reports.id  
  * title: 文章标题  
  * content: 全文内容 (Text/LongText)  
  * source\_account: 公众号名称  
  * publish\_time: 发布时间  
  * url: 原文链接  
* **hot\_topics (热点风口表 \- 节点2产出)**  
  * id: 主键  
  * report\_id: 关联 reports.id  
  * topic\_name: AI 提炼的热点名称 (如“低空经济”)  
  * related\_boards: 关联的东财板块名 (JSON数组, 如![][image2]  
    )  
  * logic\_summary: AI 总结的逻辑摘要  
  * source\_article\_ids: 关联 raw\_articles.id 的列表 (JSON数组, 用于溯源)  
* **stock\_pool\_1 (异动初筛表 \- 节点3产出)**  
  * id: 主键  
  * report\_id: 关联 reports.id  
  * stock\_code: 股票代码  
  * stock\_name: 股票名称  
  * related\_topic\_id: 关联 hot\_topics.id  
  * snapshot\_data: **关键字段**，存储入池时的行情快照 (JSON, 包含 price, change\_pct, volume\_ratio 等，确保历史回溯准确)  
  * match\_reason: 入选理由 (如 "板块涨幅\>3%, 个股量比\>2")  
* **stock\_pool\_2 (深度精选表 \- 节点4产出)**  
  * id: 主键  
  * report\_id: 关联 reports.id  
  * pool\_1\_id: 关联 stock\_pool\_1.id  
  * tech\_score: 技术面评分  
  * fund\_score: 基本面评分  
  * ai\_analysis: AI 对唯一性/稀缺性的完整分析文本  
  * is\_selected: 是否最终入选 (True/False)

#### **(2) 系统配置表**

* **target\_accounts**: 目标公众号列表 (id, account\_name, wx\_id, status)。  
* **strategy\_config**: 策略参数配置 (id, rule\_key, rule\_value, description)。

### **4.3 选股规则的可插拔设计 (Pluggable Rule Engine)**

为了实现规则的灵活配置与扩展，系统采用 **“策略模式 (Strategy Pattern)”** 结合 **“配置驱动”** 的方式来实现规则引擎。

#### **(1) 抽象基类 (Interface)**

定义一个所有规则都必须实现的统一接口 BaseRule：

class BaseRule:  
    def \_\_init\_\_(self, params):  
        self.params \= params  \# 注入参数，如 { "threshold": 50 }

    def check(self, stock\_context) \-\> RuleResult:  
        """  
        stock\_context: 包含个股代码、行情快照、关联热点等上下文信息  
        Return: RuleResult(passed=True/False, score=0.8, reason="...")  
        """  
        raise NotImplementedError

#### **(2) 规则实现 (Plugins)**

具体的规则逻辑封装在独立的类中：

* MarketCapRule: 检查市值是否在指定区间。  
* VolumeRatioRule: 检查量比是否达标。  
* MAAlignmentRule: 检查均线排列。  
* ScarcityCheckRule (AI): 调用 LLM 分析稀缺性。

#### **(3) 动态加载与编排**

1. **规则注册**：在代码中维护一个映射表 RULE\_REGISTRY \= { "market\_cap": MarketCapRule, ... }。  
2. **配置驱动**：在 strategy\_config 表中存储启用的规则链，例如：  
   {  
     "pipeline\_steps": \[  
       { "rule": "market\_cap", "params": { "min": 50, "max": 500 } },  
       { "rule": "volume\_ratio", "params": { "min": 2.0 } },  
       { "rule": "scarcity\_check", "params": { "strict\_mode": true } }  
     \]  
   }

3. **执行引擎**：  
   在执行“深度精选”节点时，引擎读取上述配置，依次实例化对应的规则类，并将股票数据传入 check 方法。只有所有规则都返回 passed=True (或总分达标) 的股票才能进入 stock\_pool\_2。

**优势**：

* **热插拔**：新增规则只需写一个新的 Python 类并在配置中启用，无需修改主流程代码。  
* **参数化**：前端“设置页面”可以直接修改 JSON 配置中的参数，实时调整选股门槛。